<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zombie Survival - Roblox Style</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(to bottom, #2c3e50, #34495e);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
        
        h1 {
            color: #ecf0f1;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }
        
        #gameCanvas {
            border: 5px solid #7f8c8d;
            background: linear-gradient(to bottom, #2ecc71 0%, #27ae60 100%);
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        
        .game-info {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            background: rgba(0,0,0,0.7);
            padding: 20px 40px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info-label {
            font-weight: bold;
            color: #ecf0f1;
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 28px;
            font-weight: bold;
            color: #3498db;
        }
        
        .info-value.health {
            color: #e74c3c;
        }
        
        .info-value.money {
            color: #f39c12;
        }
        
        .build-menu {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .build-btn {
            padding: 12px 20px;
            font-size: 15px;
            font-weight: bold;
            border: 3px solid #34495e;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: linear-gradient(to bottom, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .build-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }
        
        .build-btn.active {
            background: linear-gradient(to bottom, #3498db, #2980b9);
            box-shadow: 0 0 20px rgba(52, 152, 219, 0.6);
        }
        
        .controls {
            background: rgba(0,0,0,0.6);
            color: #ecf0f1;
            padding: 15px 30px;
            border-radius: 10px;
            margin-top: 15px;
            text-align: center;
        }
        
        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 1000;
            border: 5px solid #e74c3c;
        }
        
        .game-over h2 {
            font-size: 56px;
            color: #e74c3c;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.8);
        }
        
        .game-over button {
            padding: 15px 40px;
            font-size: 22px;
            background: linear-gradient(to bottom, #27ae60, #229954);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            font-weight: bold;
        }
        
        .game-over button:hover {
            background: linear-gradient(to bottom, #2ecc71, #27ae60);
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1>üßü ZOMBIE SURVIVAL - ROBLOX STYLE üßü</h1>
    <canvas id="gameCanvas" width="1200" height="700"></canvas>
    
    <div class="game-info">
        <div class="info-item">
            <span class="info-label">‚ù§Ô∏è HP</span>
            <span class="info-value health" id="health">1000</span>
        </div>
        <div class="info-item">
            <span class="info-label">üí∞ GELD</span>
            <span class="info-value money" id="money">100</span>
        </div>
        <div class="info-item">
            <span class="info-label">üßü ZOMBIES</span>
            <span class="info-value" id="zombies">0</span>
        </div>
        <div class="info-item">
            <span class="info-label">üíÄ KILLS</span>
            <span class="info-value" id="kills">0</span>
        </div>
        <div class="info-item">
            <span class="info-label">‚è±Ô∏è ZEIT</span>
            <span class="info-value" id="time">0:00</span>
        </div>
    </div>
    
    <div class="build-menu">
        <button class="build-btn" onclick="selectBuildMode('wood')">ü™µ HOLZ (20‚Ç¨)</button>
        <button class="build-btn" onclick="selectBuildMode('stone')">ü™® STEIN (50‚Ç¨)</button>
        <button class="build-btn" onclick="selectBuildMode('metal')">‚öôÔ∏è METALL (100‚Ç¨)</button>
        <button class="build-btn active" onclick="selectBuildMode('none')">‚öîÔ∏è KAMPF MODUS</button>
    </div>
    
    <div class="controls">
        <strong>STEUERUNG:</strong> WASD = Bewegen | Maus = Zielen | Linksklick = Schwert angreifen | Rechtsklick = Bunker bauen
    </div>
    
    <div class="game-over" id="gameOver">
        <h2>üíÄ GAME OVER üíÄ</h2>
        <p style="font-size: 24px;">Du wurdest von den Zombies √ºberrannt!</p>
        <p style="font-size: 20px; margin-top: 15px;">√úberlebenszeit: <span id="finalTime"></span></p>
        <p style="font-size: 20px;">Kills: <span id="finalKills"></span></p>
        <button onclick="restartGame()">NEU STARTEN</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Audio Context f√ºr Sounds
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Spiel Variablen
        let gameRunning = true;
        let gameTime = 0;
        let lastTimeUpdate = Date.now();
        
        const player = {
            x: canvas.width / 2,
            y: canvas.height / 2,
            width: 30,
            height: 50,
            speed: 4,
            health: 1000,
            maxHealth: 1000,
            money: 100,
            kills: 0,
            angle: 0,
            attacking: false,
            attackCooldown: 0,
            swordLength: 50,
            swordDamage: 100
        };
        
        const keys = {};
        let mouseX = 0;
        let mouseY = 0;
        let buildMode = 'none';
        
        const zombies = [];
        const bunkers = [];
        const particles = [];
        
        // Bunker Eigenschaften
        const bunkerTypes = {
            wood: { color: '#8B4513', hp: 300, cost: 20 },
            stone: { color: '#708090', hp: 800, cost: 50 },
            metal: { color: '#4A4A4A', hp: 2000, cost: 100 }
        };
        
        // Sound Funktionen
        function playSound(type, frequency = 400, duration = 0.1) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = frequency;
            gainNode.gain.value = 0.15;
            
            if (type === 'sword') {
                oscillator.type = 'sawtooth';
                gainNode.gain.value = 0.2;
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(800, audioContext.currentTime + 0.1);
            } else if (type === 'zombie') {
                oscillator.type = 'sine';
                oscillator.frequency.value = 150;
                gainNode.gain.value = 0.1;
            } else if (type === 'kill') {
                oscillator.type = 'square';
                oscillator.frequency.value = 250;
                gainNode.gain.value = 0.15;
            } else if (type === 'build') {
                oscillator.type = 'triangle';
                oscillator.frequency.value = 600;
                gainNode.gain.value = 0.1;
            } else if (type === 'hit') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.value = 100;
                gainNode.gain.value = 0.2;
            } else if (type === 'money') {
                oscillator.type = 'sine';
                oscillator.frequency.value = 800;
                gainNode.gain.value = 0.08;
            }
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }
        
        // Zombie Klasse
        class Zombie {
            constructor() {
                // Spawn au√üerhalb des Bildschirms
                const side = Math.floor(Math.random() * 4);
                if (side === 0) { // oben
                    this.x = Math.random() * canvas.width;
                    this.y = -50;
                } else if (side === 1) { // rechts
                    this.x = canvas.width + 50;
                    this.y = Math.random() * canvas.height;
                } else if (side === 2) { // unten
                    this.x = Math.random() * canvas.width;
                    this.y = canvas.height + 50;
                } else { // links
                    this.x = -50;
                    this.y = Math.random() * canvas.height;
                }
                
                this.width = 25;
                this.height = 40;
                this.speed = 1 + Math.random() * 0.5;
                this.health = 150;
                this.maxHealth = 150;
                this.damage = 10;
                this.attackCooldown = 0;
                this.color = '#2d5016';
                this.soundTimer = Math.random() * 180;
            }
            
            update() {
                this.soundTimer++;
                if (this.soundTimer > 180) {
                    playSound('zombie', 150, 0.2);
                    this.soundTimer = 0;
                }
                
                // Bewege zum Spieler
                let targetX = player.x;
                let targetY = player.y;
                let blocked = false;
                
                // Pr√ºfe Kollision mit Bunkern
                for (let bunker of bunkers) {
                    if (this.checkCollision(bunker)) {
                        blocked = true;
                        if (this.attackCooldown <= 0) {
                            bunker.hp -= this.damage;
                            this.attackCooldown = 60;
                        }
                        break;
                    }
                }
                
                if (this.attackCooldown > 0) this.attackCooldown--;
                
                if (!blocked) {
                    const dx = targetX - this.x;
                    const dy = targetY - this.y;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    
                    if (dist > 30) {
                        this.x += (dx / dist) * this.speed;
                        this.y += (dy / dist) * this.speed;
                    } else {
                        // Greife Spieler an
                        if (this.attackCooldown <= 0) {
                            player.health -= this.damage;
                            this.attackCooldown = 60;
                            playSound('hit', 100, 0.15);
                        }
                    }
                }
            }
            
            checkCollision(obj) {
                return this.x < obj.x + obj.width &&
                       this.x + this.width > obj.x &&
                       this.y < obj.y + obj.height &&
                       this.y + this.height > obj.y;
            }
            
            draw() {
                ctx.save();
                ctx.translate(this.x + this.width/2, this.y + this.height/2);
                
                // K√∂rper (blockig wie Roblox)
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.width/2, -10, this.width, 25);
                
                // Kopf
                ctx.fillStyle = '#3d6d1f';
                ctx.fillRect(-this.width/2 + 5, -this.height/2, this.width - 10, 20);
                
                // Rote Augen
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(-8, -this.height/2 + 5, 5, 5);
                ctx.fillRect(3, -this.height/2 + 5, 5, 5);
                
                // Beine
                ctx.fillStyle = this.color;
                ctx.fillRect(-10, 15, 8, 15);
                ctx.fillRect(2, 15, 8, 15);
                
                ctx.restore();
                
                // Gesundheitsbalken
                const barWidth = this.width + 10;
                const barHeight = 4;
                const healthPercent = this.health / this.maxHealth;
                
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x - 5, this.y - 15, barWidth, barHeight);
                ctx.fillStyle = healthPercent > 0.5 ? '#0F0' : healthPercent > 0.25 ? '#FF0' : '#F00';
                ctx.fillRect(this.x - 5, this.y - 15, barWidth * healthPercent, barHeight);
            }
            
            takeDamage(damage) {
                this.health -= damage;
                if (this.health <= 0) {
                    player.kills++;
                    player.money += 25;
                    createExplosion(this.x + this.width/2, this.y + this.height/2);
                    playSound('kill', 250, 0.15);
                    playSound('money', 800, 0.05);
                    return true;
                }
                return false;
            }
        }
        
        // Bunker Klasse
        class Bunker {
            constructor(x, y, type) {
                this.x = x;
                this.y = y;
                this.width = 50;
                this.height = 50;
                this.type = type;
                this.hp = bunkerTypes[type].hp;
                this.maxHp = bunkerTypes[type].hp;
                this.color = bunkerTypes[type].color;
            }
            
            draw() {
                // Hauptblock
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                
                // 3D Effekt
                ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
                ctx.fillRect(this.x, this.y, this.width, 5);
                ctx.fillRect(this.x, this.y, 5, this.height);
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
                ctx.fillRect(this.x, this.y + this.height - 5, this.width, 5);
                ctx.fillRect(this.x + this.width - 5, this.y, 5, this.height);
                
                // Rahmen
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);
                
                // HP Bar
                const hpPercent = this.hp / this.maxHp;
                ctx.fillStyle = '#000';
                ctx.fillRect(this.x, this.y - 8, this.width, 5);
                ctx.fillStyle = hpPercent > 0.5 ? '#0F0' : hpPercent > 0.25 ? '#FF0' : '#F00';
                ctx.fillRect(this.x, this.y - 8, this.width * hpPercent, 5);
            }
        }
        
        // Partikel Klasse
        class Particle {
            constructor(x, y, color) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = (Math.random() - 0.5) * 8 - 2;
                this.life = 40;
                this.maxLife = 40;
                this.color = color || '#3d6d1f';
                this.size = Math.random() * 4 + 2;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.vy += 0.3; // Gravity
                this.life--;
            }
            
            draw() {
                ctx.globalAlpha = this.life / this.maxLife;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
                ctx.globalAlpha = 1;
            }
        }
        
        function createExplosion(x, y) {
            for (let i = 0; i < 20; i++) {
                particles.push(new Particle(x, y, '#3d6d1f'));
            }
        }
        
        // Spieler zeichnen (Roblox Style)
        function drawPlayer() {
            ctx.save();
            ctx.translate(player.x, player.y);
            ctx.rotate(player.angle);
            
            // K√∂rper (blockig)
            ctx.fillStyle = '#3498db';
            ctx.fillRect(-player.width/2, -5, player.width, 30);
            
            // Kopf
            ctx.fillStyle = '#f39c12';
            ctx.fillRect(-player.width/2 + 5, -player.height/2, player.width - 10, 25);
            
            // Gesicht
            ctx.fillStyle = '#000';
            ctx.fillRect(-8, -player.height/2 + 8, 4, 4);
            ctx.fillRect(4, -player.height/2 + 8, 4, 4);
            ctx.fillRect(-5, -player.height/2 + 16, 10, 2);
            
            // Arme
            ctx.fillStyle = '#3498db';
            ctx.fillRect(-player.width/2 - 8, -5, 8, 20);
            ctx.fillRect(player.width/2, -5, 8, 20);
            
            // Beine
            ctx.fillStyle = '#2c3e50';
            ctx.fillRect(-12, 25, 10, 20);
            ctx.fillRect(2, 25, 10, 20);
            
            // Schwert
            if (player.attacking || player.attackCooldown > 0) {
                ctx.fillStyle = '#95a5a6';
                ctx.fillRect(player.width/2 + 5, -5, 8, player.swordLength);
                ctx.fillStyle = '#c0c0c0';
                ctx.fillRect(player.width/2 + 8, -5, 2, player.swordLength);
                
                // Griff
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(player.width/2 + 5, player.swordLength - 8, 8, 12);
            }
            
            ctx.restore();
            
            // HP Bar √ºber Spieler
            const barWidth = 60;
            const barHeight = 6;
            const healthPercent = player.health / player.maxHealth;
            
            ctx.fillStyle = '#000';
            ctx.fillRect(player.x - barWidth/2, player.y - player.height/2 - 15, barWidth, barHeight);
            ctx.fillStyle = healthPercent > 0.5 ? '#0F0' : healthPercent > 0.25 ? '#FF0' : '#F00';
            ctx.fillRect(player.x - barWidth/2, player.y - player.height/2 - 15, barWidth * healthPercent, barHeight);
        }
        
        // Schwert Angriff
        function swordAttack() {
            if (player.attackCooldown > 0) return;
            
            player.attacking = true;
            player.attackCooldown = 30;
            playSound('sword', 300, 0.1);
            
            // Pr√ºfe Treffer auf Zombies
            for (let i = zombies.length - 1; i >= 0; i--) {
                const zombie = zombies[i];
                const dx = zombie.x + zombie.width/2 - player.x;
                const dy = zombie.y + zombie.height/2 - player.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                // Pr√ºfe ob Zombie in Schwert-Reichweite und vor dem Spieler
                if (dist < player.swordLength + 30) {
                    const angleToZombie = Math.atan2(dy, dx);
                    const angleDiff = Math.abs(angleToZombie - player.angle);
                    
                    if (angleDiff < Math.PI / 3) { // ~60 Grad Angriffswinkel
                        if (zombie.takeDamage(player.swordDamage)) {
                            zombies.splice(i, 1);
                        }
                    }
                }
            }
            
            setTimeout(() => {
                player.attacking = false;
            }, 100);
        }
        
        // Bunker bauen
        function buildBunker(x, y) {
            if (buildMode === 'none') return;
            
            const cost = bunkerTypes[buildMode].cost;
            if (player.money < cost) return;
            
            // Grid snapping
            const gridSize = 50;
            const gridX = Math.floor(x / gridSize) * gridSize;
            const gridY = Math.floor(y / gridSize) * gridSize;
            
            // Pr√ºfe ob schon Bunker an Position
            for (let bunker of bunkers) {
                if (bunker.x === gridX && bunker.y === gridY) return;
            }
            
            // Pr√ºfe ob zu nah am Spieler
            const dx = gridX + 25 - player.x;
            const dy = gridY + 25 - player.y;
            if (Math.sqrt(dx*dx + dy*dy) < 60) return;
            
            player.money -= cost;
            bunkers.push(new Bunker(gridX, gridY, buildMode));
            playSound('build', 600, 0.08);
        }
        
        // Zombie Spawner
        function spawnZombies() {
            if (!gameRunning) return;
            
            // Spawn Rate erh√∂ht sich mit der Zeit
            const spawnChance = Math.min(0.05 + gameTime / 10000, 0.15);
            
            if (Math.random() < spawnChance) {
                zombies.push(new Zombie());
            }
            
            setTimeout(spawnZombies, 1000);
        }
        
        // Geld Regeneration
        function moneyRegeneration() {
            if (!gameRunning) return;
            
            player.money += 5;
            playSound('money', 850, 0.03);
            
            setTimeout(moneyRegeneration, 2000);
        }
        
        // Build Mode wechseln
        function selectBuildMode(mode) {
            buildMode = mode;
            document.querySelectorAll('.build-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // Maus Events
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            mouseX = e.clientX - rect.left;
            mouseY = e.clientY - rect.top;
        });
        
        canvas.addEventListener('click', (e) => {
            if (!gameRunning) return;
            swordAttack();
        });
        
        canvas.addEventListener('contextmenu', (e) => {
            e.preventDefault();
            if (!gameRunning) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            buildBunker(x, y);
        });
        
        // Tastatur Events
        document.addEventListener('keydown', (e) => {
            keys[e.key.toLowerCase()] = true;
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key.toLowerCase()] = false;
        });
        
        // Update Display
        function updateDisplay() {
            document.getElementById('health').textContent = Math.max(0, Math.floor(player.health));
            document.getElementById('money').textContent = player.money;
            document.getElementById('zombies').textContent = zombies.length;
            document.getElementById('kills').textContent = player.kills;
            
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;
            document.getElementById('time').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (player.health <= 0) {
                gameOver();
            }
        }
        
        function gameOver() {
            gameRunning = false;
            const minutes = Math.floor(gameTime / 60);
            const seconds = gameTime % 60;
            document.getElementById('finalTime').textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('finalKills').textContent = player.kills;
            document.getElementById('gameOver').style.display = 'block';
        }
        
        function restartGame() {
            location.reload();
        }
        
        // Game Loop
        function gameLoop() {
            if (!gameRunning) return;
            
            // Update Spielzeit
            const now = Date.now();
            if (now - lastTimeUpdate >= 1000) {
                gameTime++;
                lastTimeUpdate = now;
            }
            
            // Clear canvas
            ctx.fillStyle = '#2ecc71';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Gras-Textur
            ctx.fillStyle = '#27ae60';
            for (let i = 0; i < 50; i++) {
                const x = (i * 123) % canvas.width;
                const y = (i * 456) % canvas.height;
                ctx.fillRect(x, y, 3, 3);
            }
            
            // Spieler Bewegung
            if (keys['w'] || keys['arrowup']) player.y -= player.speed;
            if (keys['s'] || keys['arrowdown']) player.y += player.speed;
            if (keys['a'] || keys['arrowleft']) player.x -= player.speed;
            if (keys['d'] || keys['arrowright']) player.x += player.speed;
            
            // Spieler in Grenzen halten
            player.x = Math.max(30, Math.min(canvas.width - 30, player.x));
            player.y = Math.max(30, Math.min(canvas.height - 30, player.y));
            
            // Spieler Rotation zur Maus
            const dx = mouseX - player.x;
            const dy = mouseY - player.y;
            player.angle = Math.atan2(dy, dx);
            
            // Attack Cooldown
            if (player.attackCooldown > 0) player.attackCooldown--;
            
            // Update und zeichne Bunkers
            for (let i = bunkers.length - 1; i >= 0; i--) {
                const bunker = bunkers[i];
                bunker.draw();
                
                if (bunker.hp <= 0) {
                    bunkers.splice(i, 1);
                    createExplosion(bunker.x + 25, bunker.y + 25);
                }
            }
            
            // Update und zeichne Zombies
            for (let zombie of zombies) {
                zombie.update();
                zombie.draw();
            }
            
            // Zeichne Spieler
            drawPlayer();
            
            // Update und zeichne Partikel
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].update();
                particles[i].draw();
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }
            
            // Build Preview
            if (buildMode !== 'none') {
                const gridSize = 50;
                const gridX = Math.floor(mouseX / gridSize) * gridSize;
                const gridY = Math.floor(mouseY / gridSize) * gridSize;
                
                ctx.globalAlpha = 0.5;
                ctx.fillStyle = bunkerTypes[buildMode].color;
                ctx.fillRect(gridX, gridY, gridSize, gridSize);
                ctx.globalAlpha = 1;
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(gridX, gridY, gridSize, gridSize);
            }
            
            updateDisplay();
            requestAnimationFrame(gameLoop);
        }
        
        // Start Game
        updateDisplay();
        spawnZombies();
        moneyRegeneration();
        gameLoop();
    </script>
</body>
</html>

